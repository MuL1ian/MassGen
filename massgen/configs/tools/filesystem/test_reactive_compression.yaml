# Test Configuration: Reactive Context Compression
#
# Use Case: Test reactive compression by reading many files to fill context window
#
# This config demonstrates reactive compression behavior:
# - Single agent with filesystem access to read many files
# - When context limit is exceeded, compression triggers automatically
# - Debug logging shows compression input/output in compression_debug/
#
# Run with:
#   massgen --debug --config massgen/configs/tools/filesystem/test_reactive_compression.yaml "Read all Python files in massgen/backend/ and summarize what each one does"

agents:
  - id: "reader"
    system_message: |
      You are a code reader assistant. Your job is to read files and provide detailed summaries.
      Read files thoroughly and describe their purpose, key classes, and main functions.
      Read as many files as needed to complete the task.

    backend:
      type: "openai"
      model: "gpt-5-mini"  # Smaller context window to trigger compression faster
      cwd: "workspace_reader"

orchestrator:
  snapshot_storage: "snapshots"
  agent_temporary_workspace: "temp_workspaces"

  # Shared read-only access to massgen source code
  context_paths:
    - path: "massgen/"
      permission: "read"

  # Compression settings
  # Note: trigger_threshold is not reliably enforceable (reactive only)
  # target_ratio IS enforced - compress down to this % of messages
  coordination:
    compression_trigger_threshold: 0.50  # Would trigger at 50% if proactive worked
    compression_target_ratio: 0.20       # Preserve 20% of messages after compression

ui:
  display_type: "rich_terminal"
  logging_enabled: true

# What happens:
# 1. Agent reads files from massgen/backend/
# 2. As context fills up, provider may return context_length_exceeded error
# 3. Backend catches error, summarizes older messages using AgentDrivenCompressor
# 4. Retries with compressed context (summary + recent 20% of messages)
# 5. Debug logs saved to .massgen/massgen_logs/<session>/compression_debug/
